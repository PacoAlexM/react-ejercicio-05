import { useSearchParams } from 'react-router'
import { useQuery } from '@tanstack/react-query'
import { searchHeroesAction } from '@/heroes/actions/search-heroes.action'
import { HeroGrid } from '@/heroes/components/HeroGrid'
import { Jumbotron } from '@/components/custom/Jumbotron'
import { HeroStats } from '@/heroes/components/HeroStats'
import { SearchControls } from '@/heroes/pages/search/ui/SearchControls'
import { CustomBreadcrumb } from '@/components/custom/CustomBreadcrumb'

export const SearchPage = () => {
    const [ searchParams ] = useSearchParams();
    const name = searchParams.get('name') ?? undefined;
    const strength = searchParams.get('strength') ?? undefined;

    const { data: heroes = [] } = useQuery({
        queryKey: ['search', { name, strength }],
        queryFn: () => searchHeroesAction({ name, strength }),
        staleTime: (1000 * 60) * 5,
    });

    return (
        <>
            <Jumbotron title="Búsqueda de Super Héroes" description="Descubre, explora, y administra tus super héroes y villanos favorítos" />

            { /* Breadcrumb */ }
            <CustomBreadcrumb currentPage="Búsqueda" />

            {/* Stats Dashboard */}
            <HeroStats />

            {/* Filter and Search */}
            <SearchControls />

            {/* Results */}
            <HeroGrid heroes={ heroes } />
        </>
    );
}
